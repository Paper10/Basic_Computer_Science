# TCP/IP 4계층 모델
**인터넷 프로토콜 스위트( Internet Protocol Suite )**란 인터넷에서 노드들이 데이터를 주고받는데 쓰이는 **프로토콜의 집합**으로 **TCP/IP 4계층** 모델 또는 **OSI 7계층**으로 설명 가능하다

## 계층구조
OSI 7계층과 TCP/IP 4계층 모두 한 계층의 변화가 다른 계층에 영향을 주지 않는다는 특징을 기반으로 정의되었다.

**OSI 7계층**은 아래와 같이 분류한다
- 어플리케이션 계층
- 프레젠테이션 계층
- 세션 계층
- 전송 계층
- 네트워크 계층
- 데이터링크 계틍
- 물리 계층
이 모델에서 *어플리케이션 계층 ~ 세션계층* 부분과 *데이터링크 계층 ~ 물리 계층* 부분을 각각 하나로 통합한 모델이 아래의 TCP/IP 4계층이다
- **어플리케이션** 계층
- **전송** 계층
- **인터넷** 계층( 네트워크 계층 )
- **링크** 계층

### 어플리케이션 계층
사용자에게 실제 **서비스가 제공되는 계층**이며 *FTP, HTTP, SSH, SMTP, DNS* 등의 **응용프로그램**이 사용되는 프로토콜 계층이다.
- FTP : 파일 전송 프로토콜
- SSH : 암호화 네트워크 프로토콜
- HTTP : 인터넷 및 웹사이트를 이용하는데 사용되는 프로토콜
- SMTP : 이메일 전송을 위한 프로토콜
- DNS : 도메인과 IP를 매핑하는 서버

### 전송 계층
**송신자와 수신자를 연결**하는 서비스를 제공하는 계층으로 **데이터 흐름** 및 **신뢰성**을 제어하며 **어플리케이션 계층과 인터넷 계층** 사이의 중계역할을 담당한다. 대표적으로 **TCP,UDP**가 있다
- **TCP** : 패킷의 **순서를 보장**하고 패킷 **수신여부를 확인**하며 **신뢰성**을 구축하여 **가상회선 패킷 교환방식**을 사용한다
- **UDP** : 패킷의 순서보장 없이 수신여부를 확인하지 않으며 단순히 **빠르게 데이터를 전송**하는 **데이터 패킷 교환 방식**을 사용한다.
1. **가상회선 패킷 교환 방식**
각 패킷에 **가상회선 식별자***가 포함되며 **하나의 가상회선**을 설정하여 전송된다. 패킷을 모두 전송하면 가상회선이 해제되고 전송된 패킷들은 **순서대로** 도착하는 방식
2. **데이터그램 패킷 교환 방식**
패킷이 **독립적으로** 이동하며 **최적의 경로**를 선택하여 전송된다. 각 패킷은 **서로 다른 경로**로 전송될 수 있으며 **다른 순서**로 도착할 수 있다

TCP는 신뢰성을 확보한 연결을 진행할 떄 **3-way handshake** 과정을 거친다. UDP는 해당 과정을 거치지 않는다
1. **SYN**단계 : 클라이언트가 서버에게 **ISN**이 포함된 **SYN 패킷**을 전송한다 (클라이언트 ---1200---> 서버)
2. **SYN+ACK**단계 : 서버가 클라이언트의 **SYN 패킷을 수신**하고 **서버의 ISN**과 **클라이언트의 ISN+1** 값을 전송한다 (클라이언트 <---500,1201--- 서버)
3. **ACK**단계 : 서버의 패킷을 수신한 클라이언트가 **서버에게 받은 ISN+1값**을 전송한다 (클라이언트 ---501---> 서버)
-> **ISN** : **새로운 TCP연결**이 시작될때 할당되는 **시퀸스 번호**. 노드들은 해당 시퀸스번호에 따라 패킷의 처리를 결정한다

TCP의 연결이 해제될떄는 **4-way handshake**과정을 거친다
1. 클라이언트는 서버에게 **종료 패킷 FIN**을 전송하고 **FIN_wait**상태에 들어간다
2. 서버는 FIN이 전송되면 서버에게 **승인 패킷 ACK**를 전송하고 **CLOSE_wait** 상태에 들어간다. ACK를 전송받은 클라이언트는 **FIN_wait2** 상태에 들어간다
3. 서버는 ACK를 전송하고 **일정 시간 뒤**에 **종료패킷 FIN**을 전송한다
4. **FIN_wait2** 상태의 서버는 FIN을 전송받고 서버로 **ACK**를 전송한다. 서버는 ACK를 받으면 **CLOSED** 상태가 된다
2번쨰 handshake에서 클라이언트가 ACK를 전송받고 바로 종료되지 않고 **FIN을 다시 기다리는 이유**는 **지연된 패킷**을 마저 받는 시간을 확보하거나 마지막 단계에 ACK를 전송하여 클라이언트의 마지막 상태를 **ACK 수신** 이 아닌 **ACK 전송 후 종료** 상태로 만들기 위함이다.

### 인터넷 계층
장치로부터 받은 패킷을 **지정된 IP주소로 전송**하기 위해 사용되는 계층이며. 상대방의 패킷 **수신여부를 판단하지 않는** 비연결형적인 특징을 가진다. **IP,ARP,ICMP**등의 프로토콜이 사용된다